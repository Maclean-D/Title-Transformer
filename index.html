<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Page Title</title>
    <link rel="stylesheet" href="css/theme.css">
    <link rel="stylesheet" href="css/custom.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons" >
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto">
    <script type="module" src="./bundle.js"></script>
</head>

<body class="background on-background-text">
      
    <div style="display: flex; align-items: center; justify-content: space-between; margin-top: -1.5rem">
        <h1 class="display-medium">Title Transformer</h1>
        <div>
            <a href="https://github.com/Maclean-D/title-transformer" target="_blank">
                <md-icon-button>
                    <i class="material-icons">info</i>
                </md-icon-button>
            </a>
        </div>
    </div>
</body>

</html>

    <md-filled-text-field label="OpenAI API Key" id="apikey" type="text"></md-filled-text-field>
    <br>
    <md-outlined-select id="modelSelect" style="margin-top: 1rem;">
        <md-select-option selected value="gpt-3.5-turbo">
            <div slot="headline">GPT 3.5 Turbo (Fastest & Cheapest)</div>
        </md-select-option>
        <md-select-option value="gpt-4">
            <div slot="headline">GPT 4 (Most Capable & Expensive)</div>
        </md-select-option>
    </md-outlined-select>

    <div class="input-container" style="margin-top: 1rem; width: 27rem; display: flex; align-items: center;">             
        <textarea class="rounded-textbox" placeholder="Title" id="titleInput"></textarea>
    </div>

    <div class="input-container" style="margin-top: 1rem; width: 27rem; display: flex; align-items: center;">             
        <textarea class="rounded-textbox" placeholder="Video description (Optional)" id="description-input"></textarea>
        <md-icon-button class="mic">
            <i class="material-icons">mic</i>
        </md-icon-button>
    </div>

    <script src="src/speechrecognition.js"></script>

    <div style="margin-top: -1.5rem; margin-bottom: 2rem;"></div>
        <md-filled-button style="margin-top: 0.5rem;">
            Shuffle
            <svg slot="icon" xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24"><path d="M560-160v-80h104L537-367l57-57 126 126v-102h80v240H560Zm-344 0-56-56 504-504H560v-80h240v240h-80v-104L216-160Zm151-377L160-744l56-56 207 207-56 56Z"/></svg>
        </md-filled-button>

        <md-filled-tonal-button style="margin-top: 0.5rem;">
            Rewrite
            <svg slot="icon" xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24"><path d="M480-80q-75 0-140.5-28.5t-114-77q-48.5-48.5-77-114T120-440h80q0 117 81.5 198.5T480-160q117 0 198.5-81.5T760-440q0-117-81.5-198.5T480-720h-6l62 62-56 58-160-160 160-160 56 58-62 62h6q75 0 140.5 28.5t114 77q48.5 48.5 77 114T840-440q0 75-28.5 140.5t-77 114q-48.5 48.5-114 77T480-80Z"/></svg>
        </md-filled-tonal-button style="margin-top: 0.5rem;">

        <md-filled-tonal-button style="margin-top: 0.5rem;">
            Twist
            <svg slot="icon" xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24"><path d="M200-200h57l391-391-57-57-391 391v57Zm-80 80v-170l528-527q12-11 26.5-17t30.5-6q16 0 31 6t26 18l55 56q12 11 17.5 26t5.5 30q0 16-5.5 30.5T817-647L290-120H120Zm640-584-56-56 56 56Zm-141 85-28-29 57 57-29-28Z"/></svg>
        </md-filled-tonal-button>

        <md-outlined-button id="shortenButton" style="margin-top: 0.5rem;">
            Shorten
            <svg slot="icon" xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24"><path d="M160-360v-80h400v80H160Zm0-160v-80h640v80H160Z"/></svg>
        </md-outlined-button>
    <div>

    <script>
        async function shortenTitleWithOpenAI(title, apiKey) {
            try {
                // Retrieve the selected model from the dropdown
                const model = document.getElementById('modelSelect').value;

                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    },
                    body: JSON.stringify({
                        model: model, // Use the selected model here
                        messages: [{ role: "user", content: `Shorten the following in a super concise and snappy way: "${title}"` }],
                        temperature: 1
                    }),
                });

                const data = await response.json();

                // Check if the response has choices and it's not empty
                if (data.choices && data.choices.length > 0 && data.choices[0].message && data.choices[0].message.content) {
                    return data.choices[0].message.content.trim();
                } else {
                    console.error('Unexpected response format from OpenAI:', data);
                    return null;
                }
            } catch (error) {
                console.error('Error while calling OpenAI API:', error);
                return null;
            }
        }
    </script>

    <script>
        document.addEventListener('DOMContentLoaded', (event) => {
            const shortenButton = document.getElementById('shortenButton');
            const titleInput = document.getElementById('titleInput');
            const apiKeyInput = document.getElementById('apikey');
            const responsesDiv = document.getElementById('responses');

            shortenButton.addEventListener('click', async () => {
                const titleText = titleInput.value.trim();
                const apiKey = apiKeyInput.value.trim();

                if (titleText !== '' && apiKey !== '') {
                    // Create the response div with a loading indicator
                    const responseDiv = document.createElement('div');
                    responseDiv.classList.add('primary-container', 'on-primary-container-text');
                    responseDiv.style = 'overflow-y: auto; border-radius: 1rem; display: inline-block; margin-right: 1rem; margin-bottom: 1rem;';
                    responseDiv.innerHTML = `
                        <md-linear-progress four-color indeterminate></md-linear-progress>
                        <div style="margin-left: 1rem; margin-right: 1rem;">
                            <h3 class="body-large">Processing...</h3>
                            <h2 class="headline-small"></h2>
                        </div>
                    `;
                    responsesDiv.appendChild(responseDiv);

                    // Call OpenAI API
                    const shortenedTitle = await shortenTitleWithOpenAI(titleText, apiKey);

                    if (shortenedTitle) {
                        // Update the div with the shortened title and remove the loading indicator
                        responseDiv.querySelector('md-linear-progress').style.display = 'none';
                        responseDiv.querySelector('h3').textContent = `Shortened from: ${titleText}`;
                        responseDiv.querySelector('h2').textContent = shortenedTitle;
                    } else {
                        responseDiv.querySelector('h3').textContent = 'Error: Could not shorten the title.';
                    }
                } else {
                    alert('Please enter a title and your OpenAI API key.');
                }
            });
        });
    </script>

    <div id="responses" style="margin-top: 1rem;">
        <!-- Responses will be added here dynamically -->
    </div>
    
</html>